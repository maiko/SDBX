apiVersion: sdbx.io/v1
kind: Service
metadata:
  name: gluetun
  version: 1.0.0
  category: networking
  description: "VPN client with kill switch for Docker containers"
  homepage: https://github.com/qdm12/gluetun
  documentation: https://github.com/qdm12/gluetun-wiki
  maintainer: sdbx-official
  tags:
    - vpn
    - networking
    - security

spec:
  image:
    repository: qmcgaw/gluetun
    tag: latest
    registry: docker.io

  container:
    name_template: "sdbx-{{ .Name }}"
    restart: unless-stopped
    capabilities:
      add:
        - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"

  environment:
    static:
      - name: TZ
        value: "{{ .Config.Timezone }}"
      - name: VPN_SERVICE_PROVIDER
        value: "{{ .Config.VPNProvider }}"
      - name: SERVER_COUNTRIES
        value: "{{ .Config.VPNCountry }}"
    envFile:
      - "./configs/gluetun/gluetun.env"

  volumes:
    - name: data
      hostPath: "./data/gluetun"
      containerPath: /gluetun

  ports:
    static:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"

  networking:
    networks:
      - name: proxy
      - name: vpn

  healthcheck:
    test: ["CMD", "/gluetun-entrypoint", "healthcheck"]
    interval: 30s
    timeout: 10s
    retries: 3

routing:
  enabled: false

integrations:
  watchtower:
    enabled: true
  cloudflared:
    enabled: false
  homepage:
    enabled: false

conditions:
  requireConfig: vpn_enabled
